  <!-- Header with game info -->
  <div class="game-header">
    <div class="game-title">
      <h1>Cruce</h1>
      <div class="game-status">
        {{ getCurrentPhaseDescription() }}
      </div>
    </div>

    <div class="game-controls">
      <button class="btn btn-help" (click)="toggleHelp()">
        <span class="icon">â“</span>
        Help
      </button>
      <button class="btn btn-restart" (click)="restartGame()">
        <span class="icon">ğŸ”„</span>
        New
      </button>
    </div>
  </div>

  <!-- Compact score board (fixed position)
  <app-score-board [compact]="true"></app-score-board>
-->


<div class="players-layout">

      <!-- Teammate (front position) -->
  <div class="teammate">
    <ng-container *ngIf="getBotPlayers()[2] as teammate">
      <div class="player-info"
           [class.current-player]="gameState.currentPlayer === 2">
        <span class="player-name">{{ teammate.name }}</span>
        <span class="card-count">{{ teammate.hand.length }}</span>
        <span class="player-score" *ngIf="gameState.phase === GamePhase.PLAYING">
          {{ getCurrentHandScore(2) }}
        </span>
      </div>

      <div class="teammate-cards">
        <app-cached-card-backs
          #cachedCardsTop
          [offsetX]="15"
          [offsetY]="2"
          [fanAngle]="5"
          [maxCachedCards]="8"
          [showCacheInfo]="true">
        </app-cached-card-backs>
      </div>
    </ng-container>
  </div>


  <div class="opponents-row">
  <!-- Opponent Left (10 o'clock position) -->
  <div class="opponent-left">
    <ng-container *ngIf="getBotPlayers()[0] as opponent">
      <div class="player-info"
           [class.current-player]="gameState.currentPlayer === 1">
        <span class="player-name">{{ opponent.name }}</span>
        <span class="card-count">{{ opponent.hand.length }}</span>
        <span class="player-score" *ngIf="gameState.phase === GamePhase.PLAYING">
          {{ getCurrentHandScore(1) }}
        </span>
      </div>

      <div class="opponent-cards">
        <app-cached-card-backs
          #cachedCardsLeft
          [offsetX]="15"
          [offsetY]="2"
          [fanAngle]="5"
          [maxCachedCards]="8"
          [showCacheInfo]="false">
        </app-cached-card-backs>
      </div>
    </ng-container>
  </div>
  <!-- Opponent Right (2 o'clock position) -->
  <div class="opponent-right">
    <ng-container *ngIf="getBotPlayers()[1] as opponent">
      <div class="player-info"
           [class.current-player]="gameState.currentPlayer === 3">
        <span class="player-name">{{ opponent.name }}</span>
        <span class="card-count">{{ opponent.hand.length }}</span>
        <span class="player-score" *ngIf="gameState.phase === GamePhase.PLAYING">
          {{ getCurrentHandScore(3) }}
        </span>
      </div>

      <div class="opponent-cards">
        <app-cached-card-backs
          #cachedCardsRight
          [offsetX]="15"
          [offsetY]="2"
          [fanAngle]="5"
          [maxCachedCards]="8"
          [showCacheInfo]="false">
        </app-cached-card-backs>
      </div>
    </ng-container>
  </div>

  </div>
</div>

  <!-- Main game area (center) -->
  <div class="game-main">
    <!-- Trump suit indicator -->
    <div class="trump-indicator" *ngIf="gameState.trumpSuit">
      <div class="trump-label">Trump:</div>
      <div class="trump-suit">
        <img [src]="getCurrentTrumphIcon()" alt="{{ formatSuitName(gameState.trumpSuit) }}" class="trump-icon">
      </div>
    </div>

<!-- Current trick area -->
<div class="trick-area" *ngIf="gameState">
  <div class="trick-label" *ngIf="gameState.currentTrick.length > 0">
    Trick {{ getTrickNumber() }}
  </div>

  <div class="trick-cards"
       [class.complete]="gameState.currentTrick.length === 4 && trickWinnerID === null"
       [class.swipe-up]="trickAnimationState === 'swipe-up'"
       [class.swipe-down]="trickAnimationState === 'swipe-down'"
       [class.swipe-left]="trickAnimationState === 'swipe-left'"
       [class.swipe-right]="trickAnimationState === 'swipe-right'">

    <app-card *ngFor="let card of gameState.currentTrick; trackBy: trackByIndex"
              [card]="card"
              [isTrump]="card.suit === gameState.trumpSuit"
              size="medium"
              [class]="'card-position-' + card.playerID"
              [disabled]="true"
              [inTrick]="true">
    </app-card>

    <!-- Placeholder cards for incomplete trick -->
    <div class="card-placeholder"
         *ngFor="let placeholder of getCardBacks(4 - gameState.currentTrick.length); trackBy: trackByIndex">
    </div>
  </div>

  <div class="trick-description" *ngIf="gameState.currentTrick.length > 0">
    {{ getCurrentTrickDescription() }}
  </div>
</div>

    <!-- Bidding panel -->
    <app-bidding-panel
      *ngIf="gameState.phase === GamePhase.BIDDING"
      [currentBid]="gameState.bid"
      [currentPlayer]="gameState.players[gameState.currentPlayer]"
      [isPlayerTurn]="isHumanPlayerTurn()"
      [bidder]="gameState.bidder"
      [passedPlayers]="gameState.passedPlayers"
      (bidMade)="onBidMade($event)">
    </app-bidding-panel>

    <!-- Game help panel -->
    <div class="game-help" *ngIf="showGameHelp">
      <div class="help-content">
        <h3>Game Info</h3>
        <p>{{ getGameSummary() }}</p>

        <div class="hand-analysis" *ngIf="isHumanPlayerTurn()">
          <h4>Your Hand</h4>
          <ng-container *ngIf="getHandAnalysis() as analysis">
            <ul>
              <li>Points: {{ analysis.totalPoints }}</li>
              <li>High Cards: {{ analysis.highCards }}</li>
              <li>Marriages: {{ analysis.marriages }}</li>
              <li>Strength: {{ analysis.handStrength }}</li>
              <li *ngIf="gameState.phase === GamePhase.BIDDING">
                Rec. Bid: {{ analysis.recommendedBid }}
              </li>
            </ul>
          </ng-container>
        </div>

        <div class="play-suggestion" *ngIf="playSuggestion && showPlaySuggestion">
          <h4>Suggestion</h4>
          <p>Play: <strong>{{ formatCardName(playSuggestion.card) }}</strong></p>
          <p><em>{{ playSuggestion.reason }}</em></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Player's hand area (bottom) -->
  <div class="player-area" [class.current-player]="isHumanPlayerTurn()">
    <div class="player-info">
      <span class="player-name">{{ getHumanPlayer().name }}</span>
      <span class="current-score" *ngIf="gameState.phase === GamePhase.PLAYING">
        {{ getCurrentHandScore(0) }} pts
      </span>

      <!-- Available marriages indicator -->
      <div class="marriages-available" *ngIf="availableMarriages.length > 0">
        <span class="marriage-icon">ğŸ‘‘</span>
        {{ availableMarriages.length }} marriage(s)
      </div>
    </div>

    <!-- Player controls -->
    <div class="player-controls" *ngIf="isHumanPlayerTurn() && gameState.phase === GamePhase.PLAYING">
      <button class="btn-suggestion"
              (click)="togglePlaySuggestion()"
              [class.active]="showPlaySuggestion">
        <span class="icon">ğŸ’¡</span>
        {{ showPlaySuggestion ? 'Hide' : 'Show' }} Tip
      </button>

      <div class="hand-summary">
        <ng-container *ngIf="getHumanPlayer().hand as hand">
          <span>{{ hand.length }} cards</span>
          <span>â€¢</span>
          <span>{{ getTotalHandPoints(hand) }} pts</span>
         </ng-container>
      </div>
    </div>

    <!-- Player's hand -->
    <app-player-hand
      [cards]="getHumanPlayer().hand"
      [isPlayerTurn]="isHumanPlayerTurn()"
      [gamePhase]="gameState.phase"
      [trumpSuit]="gameState.trumpSuit"
      [currentTrick]="gameState.currentTrick"
      [selectedCard]="selectedCard"
      [availableMarriages]="availableMarriages"
      (cardPlayed)="onCardPlayed($event)"
      (cardSelected)="selectedCard = $event">
    </app-player-hand>
  </div>

  <!-- Game messages -->
  <div class="game-messages" *ngIf="gameMessages.length > 0">
    <div class="message"
         *ngFor="let message of gameMessages; trackBy: trackByIndex">
      {{ message }}
    </div>
  </div>

  <!-- Marriage announcement dialog -->
  <app-marriage-dialog
    [show]="showMarriageDialog"
    [selectedCard]="selectedCard"
    [trumpSuit]="gameState.trumpSuit"
    [playerHand]="getHumanPlayer().hand"
    [gameScore]="gameState.gameScore"
    [currentBid]="gameState.bid"
    (announce)="onMarriageDecision($event)"
    (cancel)="showMarriageDialog = false">
  </app-marriage-dialog>

  <!-- Game finished overlay -->
  <div class="game-finished-overlay" *ngIf="gameState.phase === GamePhase.FINISHED">
    <div class="game-results">
      <h2>Game Over!</h2>

      <div class="final-scores">
        <div class="team-result"
             *ngFor="let score of gameState.gameScore; let i = index"
             [class.winner]="score >= gameState.targetScore">
          <h3>{{ i === 0 ? 'Your Team' : 'Opponents' }}</h3>
          <div class="final-score">{{ score }}</div>
          <div class="winner-badge" *ngIf="score >= gameState.targetScore">ğŸ† Winner!</div>
        </div>
      </div>

      <div class="game-stats">
        <h4>Game Statistics</h4>
        <ng-container *ngIf="getGameStats() as stats">
          <ul>
            <li>Target: {{ stats.targetScore }}</li>
            <li>Final Bid: {{ stats.currentBid }} ({{ getPlayerName(stats.bidder) }})</li>
            <li>Trump: {{ stats.trumpSuit ? formatSuitName(stats.trumpSuit) : 'None' }}</li>
          </ul>
        </ng-container>
      </div>

      <div class="game-actions">
        <button class="btn btn-primary" (click)="restartGame()">
          <span class="icon">ğŸ®</span>
          Play Again
        </button>
      </div>
    </div>
  </div>
